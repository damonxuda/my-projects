<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0"
    />

    <!-- ç¤¾äº¤åª’ä½“åˆ†äº«é¢„è§ˆ -->
    <meta property="og:title" content="å­æ°æš‘å‡è¯¾ç¨‹å®‰æ’" />
    <meta
      property="og:description"
      content="2025å¹´æš‘å‡å­¦ä¹ è®¡åˆ’ï¼Œè¯¾ç¨‹å®‰æ’ä¸€ç›®äº†ç„¶ï¼Œæ”¯æŒåœ¨çº¿ç¼–è¾‘å’Œè¯¾ç¨‹æé†’"
    />
    <meta
      property="og:image"
      content="https://images.unsplash.com/photo-1434030216411-0b793f4b4173?w=1200&h=630&fit=crop&auto=format"
    />
    <meta
      property="og:url"
      content="https://damonxuda.github.io/course-schedule/"
    />
    <meta property="og:type" content="website" />

    <!-- å¾®ä¿¡åˆ†äº«ä¼˜åŒ– -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="å­æ°æš‘å‡è¯¾ç¨‹å®‰æ’" />
    <meta
      name="twitter:description"
      content="2025å¹´æš‘å‡å­¦ä¹ è®¡åˆ’ï¼Œè¯¾ç¨‹å®‰æ’ä¸€ç›®äº†ç„¶ï¼Œæ”¯æŒåœ¨çº¿ç¼–è¾‘å’Œè¯¾ç¨‹æé†’"
    />
    <meta
      name="twitter:image"
      content="https://images.unsplash.com/photo-1434030216411-0b793f4b4173?w=1200&h=630&fit=crop&auto=format"
    />

    <!-- PWA æ”¯æŒ -->
    <meta name="theme-color" content="#667eea" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="è¯¾ç¨‹è¡¨" />
    <link
      rel="apple-touch-icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23667eea'/><text x='50' y='60' font-size='50' text-anchor='middle' fill='white'>ğŸ“š</text></svg>"
    />
    <link
      rel="manifest"
      href="data:application/json,{
        'name': 'æš‘å‡è¯¾ç¨‹æ—¥å†',
        'short_name': 'è¯¾ç¨‹è¡¨',
        'start_url': '.',
        'display': 'standalone',
        'background_color': '#667eea',
        'theme_color': '#667eea',
        'icons': [
            {
                'src': 'data:image/svg+xml,<svg xmlns=\\'http://www.w3.org/2000/svg\\' viewBox=\\'0 0 100 100\\'><rect width=\\'100\\' height=\\'100\\' fill=\\'%23667eea\\'/><text x=\\'50\\' y=\\'60\\' font-size=\\'50\\' text-anchor=\\'middle\\' fill=\\'white\\'>ğŸ“š</text></svg>',
                'sizes': '192x192',
                'type': 'image/svg+xml'
            }
        ]
    }"
    />
    <title>æš‘å‡è¯¾ç¨‹æ—¥å†æé†’</title>

    <!-- å¼•å…¥æ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="css/styles.css?v=20250909" />
  </head>

  <body>
    <div class="container">
      <div class="header">
        <h1>ğŸ“ å­æ°æš‘å‡è¯¾ç¨‹å®‰æ’</h1>
        <div class="current-date" id="currentDate"></div>
      </div>

      <div class="main-content">
        <div class="calendar-nav">
          <button class="nav-btn" id="prevBtn">â† å‰ä¸€å¤©</button>
          <div class="date-display" id="displayDate"></div>
          <button class="nav-btn" id="nextBtn">åä¸€å¤© â†’</button>
        </div>

        <div class="today-schedule">
          <div class="schedule-title">ä»Šæ—¥è¯¾ç¨‹å®‰æ’</div>
          <div id="scheduleContent"></div>
        </div>

        <div class="stats">
          <div class="stat-card">
            <div class="stat-number" id="totalCourses">0</div>
            <div class="stat-label">ä»Šæ—¥è¯¾ç¨‹æ•°</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="courseHours">0</div>
            <div class="stat-label">è¯¾ç¨‹å°æ—¶æ•°</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="categoryCount">0</div>
            <div class="stat-label">è¯¾ç¨‹ç±»å‹</div>
          </div>
        </div>

        <div class="bottom-buttons">
          <button class="edit-toggle" onclick="handleEditClick()">
            âœï¸ ç¼–è¾‘è¯¾ç¨‹å®‰æ’
          </button>
          <a href="../" class="home-btn">
            ğŸ  è¿”å›é¦–é¡µ
          </a>
        </div>
      </div>
    </div>

    <!-- ç¼–è¾‘å™¨ç•Œé¢ -->
    <div class="editor-overlay" id="editorOverlay">
      <div class="editor-panel">
        <div class="editor-header">
          <div class="editor-title">ğŸ“… è¯¾ç¨‹å®‰æ’ç¼–è¾‘å™¨</div>
          <button class="close-btn" onclick="handleCloseEditor()">Ã—</button>
        </div>

        <div class="form-group">
          <label class="form-label">ğŸ“… é€‰æ‹©æ—¥æœŸ</label>
          <input
            type="date"
            class="form-input"
            id="editDate"
            onchange="handleLoadDateCourses()"
          />
        </div>

        <div class="course-list" id="courseList">
          <!-- å½“å‰æ—¥æœŸçš„è¯¾ç¨‹åˆ—è¡¨ -->
        </div>

        <div class="form-group">
          <label class="form-label">â° è¯¾ç¨‹æ—¶é—´</label>
          <div class="time-inputs">
            <input
              type="time"
              class="form-input"
              id="startTime"
              placeholder="å¼€å§‹æ—¶é—´"
            />
            <div class="time-separator">è‡³</div>
            <input
              type="time"
              class="form-input"
              id="endTime"
              placeholder="ç»“æŸæ—¶é—´"
            />
          </div>
          <div class="quick-times">
            <button
              class="quick-time-btn"
              onclick="handleSetQuickTime('09:00', '11:00')"
            >
              09:00-11:00
            </button>
            <button
              class="quick-time-btn"
              onclick="handleSetQuickTime('13:00', '15:00')"
            >
              13:00-15:00
            </button>
            <button
              class="quick-time-btn"
              onclick="handleSetQuickTime('15:30', '17:30')"
            >
              15:30-17:30
            </button>
            <button
              class="quick-time-btn"
              onclick="handleSetQuickTime('19:00', '21:00')"
            >
              19:00-21:00
            </button>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">ğŸ“š è¯¾ç¨‹åç§°</label>
          <input
            type="text"
            class="form-input"
            id="courseName"
            placeholder="è¯·è¾“å…¥è¯¾ç¨‹åç§°"
          />
        </div>

        <div class="form-group">
          <label class="form-label">ğŸ¯ è¯¾ç¨‹ç±»å‹</label>
          <select class="form-select" id="courseCategory">
            <option value="è‹±è¯­">è‹±è¯­</option>
            <option value="æ•°å­¦">æ•°å­¦</option>
            <option value="ä½“é”»">ä½“é”»</option>
            <option value="ä¸­æ–‡">ä¸­æ–‡</option>
            <option value="å…¶ä»–">å…¶ä»–</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">ğŸ“ å¤‡æ³¨è¯´æ˜ï¼ˆå¯é€‰ï¼‰</label>
          <textarea
            class="form-textarea"
            id="courseNote"
            placeholder="æ·»åŠ è¯¾ç¨‹å¤‡æ³¨æˆ–è¯´æ˜"
          ></textarea>
        </div>

        <button class="btn-primary" onclick="handleSaveCourse()" id="saveBtn">
          â• æ·»åŠ è¯¾ç¨‹
        </button>

        <div class="editor-actions">
          <button class="btn-secondary" onclick="handleCloseEditor()">
            å–æ¶ˆ
          </button>
        </div>
      </div>
    </div>

    <!-- å¼•å…¥Supabaseåº“ -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

    <!-- Clerk SDK -->
    <script crossorigin="anonymous" data-clerk-publishable-key="${CLERK_PUBLISHABLE_KEY}" src="https://clerk.damonxuda.site/npm/@clerk/clerk-js@latest/dist/clerk.browser.js" type="text/javascript"></script>

    <!-- ç¯å¢ƒå˜é‡è®¾ç½® -->
    <script>
        window.REACT_APP_SUPABASE_URL = "${REACT_APP_SUPABASE_URL}";
        window.REACT_APP_SUPABASE_ANON_KEY = "${REACT_APP_SUPABASE_ANON_KEY}";
        window.CLERK_PUBLISHABLE_KEY = "${CLERK_PUBLISHABLE_KEY}";
    </script>

    <!-- Schedule æ¨¡å—è®¤è¯åˆå§‹åŒ– -->
    <script>
      // Scheduleæ¨¡å—è®¤è¯ç³»ç»Ÿ - åŸºäºgamesæ¨¡å—çš„Clerk-JSè®¤è¯æ–¹æ¡ˆ
      (function() {
        'use strict';

        console.log('ğŸ“… Scheduleæ¨¡å—è®¤è¯ç³»ç»Ÿå¼€å§‹åˆå§‹åŒ–');

        let isAuthChecked = false;
        let authRetryCount = 0;
        const MAX_AUTH_RETRIES = 3;

        // è®¤è¯æ£€æŸ¥ç±»
        class ScheduleAuth {
          constructor() {
            this.userCache = null;
            this.tokenCache = null;
          }

          // ä»ç¼“å­˜è·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆä¸ç›´æ¥ä»Clerkè·å–ï¼‰
          async getUserFromCache() {
            try {
              // ç­–ç•¥1: ä»window.mockClerkUserè·å–ï¼ˆReactåº”ç”¨è®¾ç½®çš„ï¼‰
              if (window.mockClerkUser && window.mockClerkUser.isAuthenticated) {
                console.log('ğŸ“… ä»mockClerkUserè·å–ç”¨æˆ·ä¿¡æ¯');
                this.userCache = window.mockClerkUser;
                return window.mockClerkUser;
              }

              // ç­–ç•¥2: ä»localStorageçš„__clerk_environmentè·å–
              const clerkEnv = localStorage.getItem('__clerk_environment');
              if (clerkEnv) {
                const envData = JSON.parse(clerkEnv);
                if (envData.user && envData.session) {
                  console.log('ğŸ“… ä»localStorageè·å–ç”¨æˆ·ä¿¡æ¯');
                  this.userCache = envData.user;
                  return envData.user;
                }
              }

              // ç­–ç•¥3: å¦‚æœClerkå·²åˆå§‹åŒ–ä¸”æœ‰ç”¨æˆ·ï¼Œè·å–ä½†ä¸ç›´æ¥ä½¿ç”¨
              if (window.Clerk && window.Clerk.user) {
                console.log('ğŸ“… ä»Clerkè·å–ç”¨æˆ·ä¿¡æ¯');
                this.userCache = window.Clerk.user;
                return window.Clerk.user;
              }

              return null;
            } catch (error) {
              console.error('âŒ è·å–ç¼“å­˜ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
              return null;
            }
          }

          // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰scheduleæ¨¡å—è®¿é—®æƒé™
          async hasScheduleAccess() {
            const user = await this.getUserFromCache();
            if (!user) {
              console.log('âŒ ç”¨æˆ·æœªç™»å½• - user is null/undefined');
              return false;
            }

            console.log('ğŸ“… è·å–åˆ°ç”¨æˆ·ä¿¡æ¯:', {
              id: user.id,
              emailAddresses: user.emailAddresses,
              primaryEmailAddress: user.primaryEmailAddress,
              publicMetadata: user.publicMetadata
            });

            // æ£€æŸ¥ç®¡ç†å‘˜æƒé™
            const adminEmails = this.getAdminEmails();
            const userEmail = user.emailAddresses?.[0]?.emailAddress || user.primaryEmailAddress?.emailAddress;
            console.log(`ğŸ“… ç”¨æˆ·é‚®ç®±: ${userEmail}, ç®¡ç†å‘˜é‚®ç®±åˆ—è¡¨: ${JSON.stringify(adminEmails)}`);

            if (adminEmails.includes(userEmail)) {
              console.log('âœ… ç®¡ç†å‘˜ç”¨æˆ·ï¼Œæ‹¥æœ‰æ‰€æœ‰æ¨¡å—æƒé™');
              return true;
            }

            // æ£€æŸ¥ç”¨æˆ·çš„æˆæƒæ¨¡å—
            const authorizedModules = user.publicMetadata?.authorized_modules || [];
            const hasAccess = authorizedModules.includes('schedule');

            console.log(`ğŸ“… Scheduleæƒé™æ£€æŸ¥è¯¦æƒ…:`);
            console.log(`  - ç”¨æˆ·: ${userEmail}`);
            console.log(`  - publicMetadata:`, user.publicMetadata);
            console.log(`  - æˆæƒæ¨¡å—: ${JSON.stringify(authorizedModules)}`);
            console.log(`  - åŒ…å«schedule: ${hasAccess}`);

            return hasAccess;
          }

          // è·å–ç®¡ç†å‘˜é‚®ç®±åˆ—è¡¨
          getAdminEmails() {
            // ä»ç¯å¢ƒå˜é‡è¯»å–ç®¡ç†å‘˜é‚®ç®±ï¼Œä¸useAuth.jsä¿æŒä¸€è‡´
            const envAdmins = window.REACT_APP_ADMIN_EMAILS || 'damon.xu@gmail.com'; // é»˜è®¤å€¼
            return envAdmins.split(',').map(email => email.trim());
          }

          // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•ï¼ˆä»…ç”¨äºå‘åå…¼å®¹ï¼‰
          async isSignedIn() {
            const user = await this.getUserFromCache();
            return !!user;
          }

          // é‡å®šå‘åˆ°ä¸»é¡µç™»å½•
          redirectToLogin() {
            console.log('ğŸ”„ é‡å®šå‘åˆ°ä¸»é¡µè¿›è¡Œç™»å½•');
            const currentUrl = encodeURIComponent(window.location.href);
            window.location.href = `/?auth=signin&redirect=${currentUrl}`;
          }
        }

        // åˆ›å»ºè®¤è¯å®ä¾‹
        const scheduleAuth = new ScheduleAuth();
        window.scheduleAuth = scheduleAuth; // æš´éœ²ç»™å…¶ä»–æ¨¡å—ä½¿ç”¨

        // è®¤è¯æ£€æŸ¥å‡½æ•°
        async function checkAuthentication() {
          try {
            console.log('ğŸ” å¼€å§‹Scheduleæ¨¡å—æƒé™æ£€æŸ¥...');

            const hasAccess = await scheduleAuth.hasScheduleAccess();

            if (hasAccess) {
              console.log('âœ… ç”¨æˆ·æœ‰Scheduleæ¨¡å—è®¿é—®æƒé™');
              isAuthChecked = true;

              // æ˜¾ç¤ºä¸»è¦å†…å®¹
              const mainContent = document.querySelector('.container');
              if (mainContent) {
                mainContent.style.display = 'block';
              }

              // åˆå§‹åŒ–Scheduleåº”ç”¨
              if (typeof initializeScheduleApp === 'function') {
                console.log('ğŸš€ å¼€å§‹åˆå§‹åŒ–Scheduleåº”ç”¨...');
                console.log('ğŸ“Š ç¯å¢ƒå˜é‡æ£€æŸ¥:', {
                  SUPABASE_URL: window.REACT_APP_SUPABASE_URL,
                  SUPABASE_KEY_EXISTS: !!window.REACT_APP_SUPABASE_ANON_KEY,
                  SUPABASE_CLIENT_EXISTS: !!window.supabase,
                  APP_CONFIG_EXISTS: !!window.appConfig
                });
                initializeScheduleApp();
              } else {
                console.error('âŒ initializeScheduleAppå‡½æ•°æœªæ‰¾åˆ°');
              }

              return true;
            } else {
              const isSignedIn = await scheduleAuth.isSignedIn();

              if (!isSignedIn) {
                console.log('âŒ ç”¨æˆ·æœªç™»å½•ï¼Œéœ€è¦é‡å®šå‘åˆ°ç™»å½•é¡µ');
              } else {
                console.log('âŒ ç”¨æˆ·å·²ç™»å½•ä½†æ— Scheduleæ¨¡å—è®¿é—®æƒé™');
              }

              // å»¶è¿Ÿé‡å®šå‘ï¼Œç»™Clerkæ›´å¤šæ—¶é—´åˆå§‹åŒ–
              if (authRetryCount < MAX_AUTH_RETRIES) {
                authRetryCount++;
                console.log(`â° ç­‰å¾…è®¤è¯çŠ¶æ€æ›´æ–°... (${authRetryCount}/${MAX_AUTH_RETRIES})`);
                setTimeout(checkAuthentication, 1000);
                return false;
              } else {
                // æ ¹æ®æƒ…å†µæ˜¾ç¤ºä¸åŒçš„é”™è¯¯ä¿¡æ¯
                if (isSignedIn) {
                  // å·²ç™»å½•ä½†æ— æƒé™ï¼Œæ˜¾ç¤ºé”™è¯¯é¡µé¢
                  showAccessDeniedPage();
                } else {
                  // æœªç™»å½•ï¼Œæ˜¾ç¤ºç™»å½•é¡µé¢
                  showLoginRequiredPage();
                }
                return false;
              }
            }
          } catch (error) {
            console.error('âŒ æƒé™æ£€æŸ¥å¤±è´¥:', error);

            // ä¸è¦ç›´æ¥é‡å®šå‘ï¼Œè€Œæ˜¯æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
            if (authRetryCount < MAX_AUTH_RETRIES) {
              authRetryCount++;
              console.log(`â° è®¤è¯å¼‚å¸¸ï¼Œé‡è¯•ä¸­... (${authRetryCount}/${MAX_AUTH_RETRIES})`);
              setTimeout(checkAuthentication, 1000);
              return false;
            } else {
              // å¤šæ¬¡é‡è¯•åä»å¤±è´¥ï¼Œæ˜¾ç¤ºç™»å½•é¡µé¢
              showLoginRequiredPage();
              return false;
            }
          }
        }

        // åˆ›å»ºæ¨¡æ€å¼¹çª—åŸºç¡€ç»“æ„
        function createModal(title, message, buttons) {
          // ç§»é™¤ç°æœ‰çš„åŠ è½½ç•Œé¢
          const loading = document.getElementById('auth-loading');
          if (loading) {
            loading.remove();
          }

          // æ˜¾ç¤ºä¸»é¡µé¢å†…å®¹ä½†ä¿æŒæ¨¡ç³Š
          const mainContent = document.querySelector('.container');
          if (mainContent) {
            mainContent.style.display = 'block';
            mainContent.style.filter = 'blur(3px)';
            mainContent.style.pointerEvents = 'none';
          }

          // åˆ›å»ºæ¨¡æ€å¼¹çª—
          const modal = document.createElement('div');
          modal.id = 'auth-modal';
          modal.innerHTML = `
            <div style="
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background: rgba(0, 0, 0, 0.6);
              display: flex;
              align-items: center;
              justify-content: center;
              z-index: 10000;
              backdrop-filter: blur(2px);
            ">
              <div style="
                background: white;
                border-radius: 16px;
                padding: 2rem;
                max-width: 420px;
                width: 90%;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
                text-align: center;
                font-family: -apple-system, BlinkMacSystemFont, sans-serif;
                animation: modalSlideIn 0.3s ease-out;
              ">
                <div style="font-size: 3rem; margin-bottom: 1rem;">${title.icon}</div>
                <div style="font-size: 1.5rem; margin-bottom: 1rem; font-weight: 600; color: #333;">${title.text}</div>
                <div style="font-size: 1rem; margin-bottom: 2rem; color: #666; line-height: 1.5;">${message}</div>
                <div style="display: flex; gap: 0.5rem; justify-content: center; flex-wrap: wrap;">
                  ${buttons.map(btn => `
                    <button onclick="${btn.action}" style="
                      background: ${btn.primary ? '#667eea' : 'transparent'};
                      border: ${btn.primary ? 'none' : '2px solid #667eea'};
                      border-radius: 8px;
                      color: ${btn.primary ? 'white' : '#667eea'};
                      padding: 0.8rem 1.5rem;
                      font-size: 1rem;
                      font-weight: 600;
                      cursor: pointer;
                      transition: all 0.3s ease;
                      min-width: 100px;
                    " onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px rgba(102, 126, 234, 0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                      ${btn.text}
                    </button>
                  `).join('')}
                </div>
              </div>
            </div>
            <style>
              @keyframes modalSlideIn {
                from {
                  opacity: 0;
                  transform: translateY(-20px) scale(0.95);
                }
                to {
                  opacity: 1;
                  transform: translateY(0) scale(1);
                }
              }
            </style>
          `;
          document.body.appendChild(modal);
        }

        // æ˜¾ç¤ºè®¿é—®è¢«æ‹’ç»æ¨¡æ€æ¡†
        function showAccessDeniedPage() {
          createModal(
            { icon: 'ğŸ”’', text: 'è®¿é—®è¢«æ‹’ç»' },
            'æ‚¨æ²¡æœ‰è®¿é—®è¯¾ç¨‹å®‰æ’æ¨¡å—çš„æƒé™ã€‚<br/>è¯·è”ç³»ç®¡ç†å‘˜ç”³è¯·è®¿é—®æƒé™ã€‚',
            [
              {
                text: 'è¿”å›ä¸»é¡µ',
                action: "window.location.href='/'",
                primary: true
              }
            ]
          );
        }

        // æ˜¾ç¤ºæœªç™»å½•æ¨¡æ€æ¡†
        function showLoginRequiredPage() {
          createModal(
            { icon: 'ğŸ”', text: 'éœ€è¦ç™»å½•' },
            'è®¿é—®è¯¾ç¨‹å®‰æ’æ¨¡å—éœ€è¦å…ˆç™»å½•æ‚¨çš„è´¦æˆ·ã€‚',
            [
              {
                text: 'ç«‹å³ç™»å½•',
                action: "window.location.href='/?auth=signin&redirect=' + encodeURIComponent(window.location.href)",
                primary: true
              },
              {
                text: 'è¿”å›ä¸»é¡µ',
                action: "window.location.href='/'",
                primary: false
              }
            ]
          );
        }

        // åˆå§‹åŒ–å‡½æ•°
        async function initializeAuth() {
          // å…ˆéšè—ä¸»è¦å†…å®¹
          const mainContent = document.querySelector('.container');
          if (mainContent) {
            mainContent.style.display = 'none';
          }

          // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
          const loadingDiv = document.createElement('div');
          loadingDiv.id = 'auth-loading';
          loadingDiv.innerHTML = `
            <div style="
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              display: flex;
              align-items: center;
              justify-content: center;
              color: white;
              font-family: -apple-system, BlinkMacSystemFont, sans-serif;
              z-index: 9999;
            ">
              <div style="text-align: center;">
                <div style="font-size: 2rem; margin-bottom: 1rem;">ğŸ“…</div>
                <div style="font-size: 1.2rem; margin-bottom: 0.5rem;">è¯¾ç¨‹å®‰æ’</div>
                <div style="font-size: 0.9rem; opacity: 0.8;">æ­£åœ¨éªŒè¯ç™»å½•çŠ¶æ€...</div>
              </div>
            </div>
          `;
          document.body.appendChild(loadingDiv);

          // ç­‰å¾…Clerkåˆå§‹åŒ–
          if (window.Clerk) {
            try {
              await window.Clerk.load({
                domain: window.location.hostname,
                cookieDomain: window.location.hostname.startsWith('localhost')
                  ? 'localhost'
                  : `.${window.location.hostname}`,
                cookiePath: '/',
                allowOrigins: [
                  window.location.origin,
                  `${window.location.protocol}//${window.location.hostname}`,
                  `${window.location.protocol}//${window.location.hostname}/schedule`,
                  `${window.location.protocol}//${window.location.hostname}/quiz`,
                  `${window.location.protocol}//${window.location.hostname}/admin`,
                  `${window.location.protocol}//${window.location.hostname}/videos`,
                  `${window.location.protocol}//${window.location.hostname}/games`
                ],
                sessionSyncing: true
              });

              console.log('âœ… Clerkåˆå§‹åŒ–å®Œæˆ');
            } catch (error) {
              console.warn('âš ï¸ Clerkåˆå§‹åŒ–å¤±è´¥ï¼Œä½†ç»§ç»­è®¤è¯æ£€æŸ¥:', error);
            }
          }

          // æ‰§è¡Œè®¤è¯æ£€æŸ¥
          const authResult = await checkAuthentication();

          // åªæœ‰è®¤è¯æˆåŠŸæ—¶æ‰ç§»é™¤åŠ è½½çŠ¶æ€ï¼Œå¤±è´¥æ—¶ç”±å…·ä½“çš„é”™è¯¯å¤„ç†å‡½æ•°æ¥å¤„ç†ç•Œé¢
          if (authResult) {
            const loading = document.getElementById('auth-loading');
            if (loading) {
              loading.remove();
            }
          }

          return authResult;
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', initializeAuth);
        } else {
          initializeAuth();
        }

        // ç›‘å¬è®¤è¯çŠ¶æ€å˜åŒ–
        if (window.Clerk) {
          window.Clerk.addListener(({ user, session }) => {
            if (!isAuthChecked && (user || session)) {
              console.log('ğŸ”„ æ£€æµ‹åˆ°è®¤è¯çŠ¶æ€å˜åŒ–ï¼Œé‡æ–°æ£€æŸ¥');
              checkAuthentication();
            }
          });
        }

      })();
    </script>

    <!-- å¼•å…¥JavaScriptæ–‡ä»¶ -->
    <script src="js/config.js"></script>
    <script src="js/app.js"></script>
  </body>
</html>

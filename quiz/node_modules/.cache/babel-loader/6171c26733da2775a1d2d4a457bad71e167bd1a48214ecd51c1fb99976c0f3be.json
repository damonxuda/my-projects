{"ast":null,"code":"var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}function rejected(value){try{step(generator[\"throw\"](value));}catch(e){reject(e);}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}step((generator=generator.apply(thisArg,_arguments||[])).next());});};// @ts-ignore\nimport nodeFetch,{Headers as NodeFetchHeaders}from'@supabase/node-fetch';export const resolveFetch=customFetch=>{let _fetch;if(customFetch){_fetch=customFetch;}else if(typeof fetch==='undefined'){_fetch=nodeFetch;}else{_fetch=fetch;}return function(){return _fetch(...arguments);};};export const resolveHeadersConstructor=()=>{if(typeof Headers==='undefined'){return NodeFetchHeaders;}return Headers;};export const fetchWithAuth=(supabaseKey,getAccessToken,customFetch)=>{const fetch=resolveFetch(customFetch);const HeadersConstructor=resolveHeadersConstructor();return(input,init)=>__awaiter(void 0,void 0,void 0,function*(){var _a;const accessToken=(_a=yield getAccessToken())!==null&&_a!==void 0?_a:supabaseKey;let headers=new HeadersConstructor(init===null||init===void 0?void 0:init.headers);if(!headers.has('apikey')){headers.set('apikey',supabaseKey);}if(!headers.has('Authorization')){headers.set('Authorization',\"Bearer \".concat(accessToken));}return fetch(input,Object.assign(Object.assign({},init),{headers}));});};","map":{"version":3,"names":["nodeFetch","Headers","NodeFetchHeaders","resolveFetch","customFetch","_fetch","fetch","arguments","resolveHeadersConstructor","fetchWithAuth","supabaseKey","getAccessToken","HeadersConstructor","input","init","__awaiter","accessToken","_a","headers","has","set","concat","Object","assign"],"sources":["/Users/damonxu/Documents/GitHub/my-projects/auth/node_modules/@supabase/supabase-js/src/lib/fetch.ts"],"sourcesContent":["// @ts-ignore\nimport nodeFetch, { Headers as NodeFetchHeaders } from '@supabase/node-fetch'\n\ntype Fetch = typeof fetch\n\nexport const resolveFetch = (customFetch?: Fetch): Fetch => {\n  let _fetch: Fetch\n  if (customFetch) {\n    _fetch = customFetch\n  } else if (typeof fetch === 'undefined') {\n    _fetch = nodeFetch as unknown as Fetch\n  } else {\n    _fetch = fetch\n  }\n  return (...args: Parameters<Fetch>) => _fetch(...args)\n}\n\nexport const resolveHeadersConstructor = () => {\n  if (typeof Headers === 'undefined') {\n    return NodeFetchHeaders\n  }\n\n  return Headers\n}\n\nexport const fetchWithAuth = (\n  supabaseKey: string,\n  getAccessToken: () => Promise<string | null>,\n  customFetch?: Fetch\n): Fetch => {\n  const fetch = resolveFetch(customFetch)\n  const HeadersConstructor = resolveHeadersConstructor()\n\n  return async (input, init) => {\n    const accessToken = (await getAccessToken()) ?? supabaseKey\n    let headers = new HeadersConstructor(init?.headers)\n\n    if (!headers.has('apikey')) {\n      headers.set('apikey', supabaseKey)\n    }\n\n    if (!headers.has('Authorization')) {\n      headers.set('Authorization', `Bearer ${accessToken}`)\n    }\n\n    return fetch(input, { ...init, headers })\n  }\n}\n"],"mappings":"ijBAAA;AACA,MAAO,CAAAA,SAAS,EAAIC,OAAO,GAAI,CAAAC,gBAAgB,KAAQ,sBAAsB,CAI7E,MAAO,MAAM,CAAAC,YAAY,CAAIC,WAAmB,EAAW,CACzD,GAAI,CAAAC,MAAa,CACjB,GAAID,WAAW,CAAE,CACfC,MAAM,CAAGD,WAAW,C,CACrB,IAAM,IAAI,MAAO,CAAAE,KAAK,GAAK,WAAW,CAAE,CACvCD,MAAM,CAAGL,SAA6B,C,CACvC,IAAM,CACLK,MAAM,CAAGC,KAAK,C,CAEhB,MAAO,kBAAgC,CAAAD,MAAM,CAAC,GAAAE,SAAO,CAAC,GACxD,CAAC,CAED,MAAO,MAAM,CAAAC,yBAAyB,CAAGA,CAAA,GAAK,CAC5C,GAAI,MAAO,CAAAP,OAAO,GAAK,WAAW,CAAE,CAClC,MAAO,CAAAC,gBAAgB,C,CAGzB,MAAO,CAAAD,OAAO,CAChB,CAAC,CAED,MAAO,MAAM,CAAAQ,aAAa,CAAGA,CAC3BC,WAAmB,CACnBC,cAA4C,CAC5CP,WAAmB,GACV,CACT,KAAM,CAAAE,KAAK,CAAGH,YAAY,CAACC,WAAW,CAAC,CACvC,KAAM,CAAAQ,kBAAkB,CAAGJ,yBAAyB,EAAE,CAEtD,MAAO,CAAOK,KAAK,CAAEC,IAAI,GAAIC,SAAA,kC,OAC3B,KAAM,CAAAC,WAAW,CAAG,CAAAC,EAAA,CAAC,KAAM,CAAAN,cAAc,EAAG,UAAAM,EAAA,UAAAA,EAAA,CAAIP,WAAW,CAC3D,GAAI,CAAAQ,OAAO,CAAG,GAAI,CAAAN,kBAAkB,CAACE,IAAI,SAAJA,IAAI,iBAAJA,IAAI,CAAEI,OAAO,CAAC,CAEnD,GAAI,CAACA,OAAO,CAACC,GAAG,CAAC,QAAQ,CAAC,CAAE,CAC1BD,OAAO,CAACE,GAAG,CAAC,QAAQ,CAAEV,WAAW,CAAC,C,CAGpC,GAAI,CAACQ,OAAO,CAACC,GAAG,CAAC,eAAe,CAAC,CAAE,CACjCD,OAAO,CAACE,GAAG,CAAC,eAAe,WAAAC,MAAA,CAAYL,WAAW,CAAE,CAAC,C,CAGvD,MAAO,CAAAV,KAAK,CAACO,KAAK,CAAAS,MAAA,CAAAC,MAAA,CAAAD,MAAA,CAAAC,MAAA,IAAOT,IAAI,GAAEI,OAAO,GAAG,CAC3C,CAAC,EACH,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}